<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.swm.vnb.dao.ScriptDAO">
    <select id="getScript" parameterType="HashMap" resultType="ScriptVO">
        SELECT script_id, title, is_recording, audio_file, video_file, created_at
        FROM script
        WHERE
            script_id = #{scriptId}
            AND user_id = #{userId}
    </select>

    <insert id="createScript" parameterType="ScriptVO" useGeneratedKeys="true" keyProperty="scriptId">
        INSERT INTO script
            (user_id, category_id, is_recording, audio_file, video_file)
        VALUES
            (#{userId}, #{categoryId}, #{isRecording}, #{audioFile}, #{videoFile})
    </insert>

    <select id="getScriptParagraphs" parameterType="HashMap" resultType="ScriptParagraphVO">
        SELECT sp.paragraph_id, sp.script_id, sp.paragraph_sequence, sp.start_time, sp.end_time,
            sp.paragraph_content, sp.memo_content, sp.is_bookmarked, sp.created_at
        FROM script_paragraph sp
        INNER JOIN script s ON sp.script_id = s.script_id
        WHERE
            s.script_id = #{scriptId}
            AND s.user_id = #{userId}
    </select>

    <insert id="createParagraph" parameterType="ScriptParagraphVO" useGeneratedKeys="true" keyProperty="paragraphId">
        INSERT INTO script_paragraph
            (script_id, user_id, paragraph_sequence, start_time,
            end_time, paragraph_content, memo_content, is_bookmarked)
        VALUES
            (#{scriptId}, #{userId}, #{paragarphSequence}, #{startTime},
            #{endTime}, #{paragraphContent}, #{memoContent}, #{isBookmarked})
    </insert>

    <update id="updateParagraph" parameterType="ScriptParagraphVO">
        UPDATE script_paragraph
        SET start_time = #{startTime},
            end_time = #{endTime},
            paragraph_content = #{paragraphContent},
            memo_content = #{memoContent},
            is_bookmarked = #{isBookmarked}
        WHERE
            paragraph_id = #{paragraphId}
            AND user_id = #{userId}
    </update>

    <delete id="deleteParagraph" parameterType="HashMap">
        DELETE FROM script_paragraph
        WHERE
            paragraph_id = #{paragraphId}
            AND user_id = #{userId}
    </delete>

    <delete id="deleteScriptsByUserId" parameterType="int">
        DELETE FROM script
        WHERE user_id = #{userId}
    </delete>

    <delete id="deleteKeywordsByUserId" parameterType="int">
        DELETE FROM script_keyword
        WHERE user_id = #{userId}
    </delete>

    <delete id="deleteParagraphsByUserId" parameterType="int">
        DELETE FROM script_paragraph
        WHERE user_id = #{userId}
    </delete>
</mapper>
